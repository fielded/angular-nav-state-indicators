!function(t){"use strict";t="default"in t?t.default:t;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]},i=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n].status;return r?e[r].push(n):e.unknown.push(n),e},{understock:[],"re-stock":[],ok:[],overstock:[],unknown:[]})},s=function(){function t(e,r,o,i,s,c,u){n(this,t),this.$q=e,this.STOCK_STATUSES=r,this.lgasService=o,this.statesService=i,this.zonesService=s,this.thresholdsService=c,this.productListService=u}return r(t,[{key:"decorateWithIndicators",value:function(t){var n=this,r=void 0,s=void 0,c=void 0,u=void 0,a=function(t,n,r,i){var s=i.location.lga,c=i.location.state;if(s)return o(t,function(t){return t.id===s});if(c)return o(n,function(t){return t.id===c});var u=function(){var t=i.location.zone;return{v:o(r,function(e){return e.id===t})}}();return"object"===("undefined"==typeof u?"undefined":e(u))?u.v:void 0},l=function(t){var e=a(r,s,c,t),i=n.thresholdsService.calculateThresholds(e,t),l=t.stock,v=Object.keys(l).reduce(function(t,e){var n=l[e],r=void 0,s=void 0,c=o(u,function(t){return t._id===e});if(i){var a=i[e];if(a){r="overstock",n<=a.min?r="understock":n<=a.reOrder?r="re-stock":n<=a.max&&(r="ok");var v=a.max-n;if(s=v,c){var S=v%c.presentation;s=S>0?v+(c.presentation-S):v}}}return t[e]={status:r,amount:n,allocation:s},t},{});return t.stock=v,t},v=function(t){var e=i(t.stock);return t.reStockNeeded=!!(e.understock.length+e["re-stock"].length),t},S=function(t){var e=i(t.stock).unknown.length,r=i(t.stock).understock.length;return t.location&&(r>=n.STOCK_STATUSES.alert.threshold?t.stockLevelStatus=n.STOCK_STATUSES.alert.id:r>=n.STOCK_STATUSES.warning.threshold?t.stockLevelStatus=n.STOCK_STATUSES.warning.id:e?t.stockLevelStatus="unknown":t.stockLevelStatus=n.STOCK_STATUSES.ok.id),t},f=function(t){return t.stock&&Object.keys(t.stock).length},d=function(e){return r=e.lgas,s=e.states,c=e.zones,u=e.products,t.filter(f).map(l).map(v).map(S)},h={lgas:this.lgasService.list(),states:this.statesService.list(),zones:this.zonesService.list(),products:this.productListService.relevant()};return this.$q.all(h).then(d)}}]),t}();s.$inject=["$q","STOCK_STATUSES","lgasService","statesService","zonesService","thresholdsService","productListService"],t.module("angularNavStateIndicators",["angularNavData","angularNavThresholds"]).service("stateIndicatorsService",s)}(angular);