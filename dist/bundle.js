!function(t){"use strict";t="default"in t?t.default:t;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]},a=function(t){return Object.keys(t).reduce(function(e,r){var n=t[r].status;return n&&e[n].push(r),e},{understock:[],"re-stock":[],ok:[],overstock:[]})},i=function(){function t(e,n,o,a,i){r(this,t),this.$q=e,this.STOCK_STATUSES=n,this.lgasService=o,this.statesService=a,this.thresholdsService=i}return n(t,[{key:"decorateWithIndicators",value:function(t){var r=this,n=void 0,i=void 0,s=function(t,r,n){var a=n.location.lga;if(a)return o(t,function(t){return t.id===a});var i=function(){var t=n.location.state;return{v:o(r,function(e){return e.id===t})}}();return"object"===("undefined"==typeof i?"undefined":e(i))?i.v:void 0},c=function(t){var e=s(n,i,t),o=r.thresholdsService.calculateThresholds(e,t),a=t.stock,c=Object.keys(a).reduce(function(t,e){var r=a[e],n=void 0,i=void 0;if(o){var s=o[e];s&&(n="overstock",r<=s.min?n="understock":r<=s.reOrder?n="re-stock":r<=s.max&&(n="ok"),i=s.max-r)}return t[e]={status:n,amount:r,allocation:i},t},{});return t.stock=c,t},u=function(t){var e=a(t.stock);return t.reStockNeeded=!!(e.understock.length+e["re-stock"].length),t},l=function(t){var e=a(t.stock).understock.length;return t.store&&"lga"===t.store.type&&(e>=r.STOCK_STATUSES.alert.threshold?t.stockLevelStatus=r.STOCK_STATUSES.alert.id:e>=r.STOCK_STATUSES.warning.threshold?t.stockLevelStatus=r.STOCK_STATUSES.warning.id:t.stockLevelStatus=r.STOCK_STATUSES.ok.id),t},S=function(e){return n=e.lgas,i=e.states,t.map(c).map(u).map(l)},f={lgas:this.lgasService.list(),states:this.statesService.list()};return this.$q.all(f).then(S)}}]),t}();i.$inject=["$q","STOCK_STATUSES","lgasService","statesService","thresholdsService"],t.module("angularNavStateIndicators",["angularNavData","angularNavThresholds"]).service("stateIndicatorsService",i)}(angular);