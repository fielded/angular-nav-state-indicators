!function(t){"use strict";t="default"in t?t.default:t;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),o=function(t,e){for(var r=0;r<t.length;r++)if(e(t[r]))return t[r]},i=function(t){return Object.keys(t).reduce(function(e,r){var n=t[r].status;return n&&e[n].push(r),e},{understock:[],"re-stock":[],ok:[],overstock:[]})},s=function(){function t(e,n,o,i,s,c){r(this,t),this.$q=e,this.STOCK_STATUSES=n,this.lgasService=o,this.statesService=i,this.thresholdsService=s,this.productListService=c}return n(t,[{key:"decorateWithIndicators",value:function(t){var r=this,n=void 0,s=void 0,c=void 0,a=function(t,r,n){var i=n.location.lga;if(i)return o(t,function(t){return t.id===i});var s=function(){var t=n.location.state;return{v:o(r,function(e){return e.id===t})}}();return"object"===("undefined"==typeof s?"undefined":e(s))?s.v:void 0},u=function(t){var e=a(n,s,t),i=r.thresholdsService.calculateThresholds(e,t),u=t.stock,l=Object.keys(u).reduce(function(t,e){var r=u[e],n=void 0,s=void 0,a=o(c,function(t){return t._id===e});if(i){var l=i[e];if(l){n="overstock",r<=l.min?n="understock":r<=l.reOrder?n="re-stock":r<=l.max&&(n="ok");var S=l.max-r;if(s=S,a){var f=S%a.presentation;s=f>0?S+(a.presentation-f):S}}}return t[e]={status:n,amount:r,allocation:s},t},{});return t.stock=l,t},l=function(t){var e=i(t.stock);return t.reStockNeeded=!!(e.understock.length+e["re-stock"].length),t},S=function(t){var e=i(t.stock).understock.length;return t.location&&(e>=r.STOCK_STATUSES.alert.threshold?t.stockLevelStatus=r.STOCK_STATUSES.alert.id:e>=r.STOCK_STATUSES.warning.threshold?t.stockLevelStatus=r.STOCK_STATUSES.warning.id:t.stockLevelStatus=r.STOCK_STATUSES.ok.id),t},f=function(t){return t.stock&&Object.keys(t.stock).length},v=function(e){return n=e.lgas,s=e.states,c=e.products,t.filter(f).map(u).map(l).map(S)},d={lgas:this.lgasService.list(),states:this.statesService.list(),products:this.productListService.relevant()};return this.$q.all(d).then(v)}}]),t}();s.$inject=["$q","STOCK_STATUSES","lgasService","statesService","thresholdsService","productListService"],t.module("angularNavStateIndicators",["angularNavData","angularNavThresholds"]).service("stateIndicatorsService",s)}(angular);