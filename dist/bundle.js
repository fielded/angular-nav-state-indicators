!function(t){"use strict";t="default"in t?t.default:t;var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(t,e){for(var n=0;n<t.length;n++)if(e(t[n]))return t[n]},i=function(t){return Object.keys(t).reduce(function(e,n){var r=t[n].status;return r&&e[r].push(n),e},{understock:[],"re-stock":[],ok:[],overstock:[]})},a=function(){function t(e,r,o,i,a){n(this,t),this.$q=e,this.STOCK_STATUSES=r,this.lgasService=o,this.statesService=i,this.thresholdsService=a}return r(t,[{key:"decorateWithIndicators",value:function(t){var n=this,r=void 0,a=void 0,s=function(t,n,r){var i=r.location.lga;if(i)return o(t,function(t){return t.id===i});var a=function(){var t=r.location.state;return{v:o(n,function(e){return e.id===t})}}();return"object"===("undefined"==typeof a?"undefined":e(a))?a.v:void 0},c=function(t){var e=s(r,a,t),o=n.thresholdsService.calculateThresholds(e,t),i=t.stock,c=Object.keys(i).reduce(function(t,e){var n=i[e],r=void 0,a=void 0;if(o){var s=o[e];s&&(r="overstock",n<=s.min?r="understock":n<=s.reOrder?r="re-stock":n<=s.max&&(r="ok"),a=s.max-n)}return t[e]={status:r,amount:n,allocation:a},t},{});return t.stock=c,t},u=function(t){var e=i(t.stock);return t.reStockNeeded=!!(e.understock.length+e["re-stock"].length),t},l=function(t){var e=i(t.stock).understock.length;return t.location&&t.location.lga&&(e>=n.STOCK_STATUSES.alert.threshold?t.stockLevelStatus=n.STOCK_STATUSES.alert.id:e>=n.STOCK_STATUSES.warning.threshold?t.stockLevelStatus=n.STOCK_STATUSES.warning.id:t.stockLevelStatus=n.STOCK_STATUSES.ok.id),t},S=function(t){return t.stock&&Object.keys(t.stock).length},f=function(e){return r=e.lgas,a=e.states,t.filter(S).map(c).map(u).map(l)},v={lgas:this.lgasService.list(),states:this.statesService.list()};return this.$q.all(v).then(f)}}]),t}();a.$inject=["$q","STOCK_STATUSES","lgasService","statesService","thresholdsService"],t.module("angularNavStateIndicators",["angularNavData","angularNavThresholds"]).service("stateIndicatorsService",a)}(angular);